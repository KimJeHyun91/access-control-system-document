openapi: "3.0.1"
info:
  title: "Access Control Service API"
  description: |
    출입 제어 서비스(Access Control Service)를 위한 REST API 명세서입니다.<br>
    PostgreSQL 스키마를 기반으로 작성되었습니다.<br>
    모든 필드명은 카멜케이스(camelCase)를 사용합니다.<br>
    **(참고: 인증(401), 권한(403), 서버 오류(500), 잘못된 요청(400) 등 공통 에러는 문서 간소화를 위해 각 API 명세에서 생략되었습니다.)**
  version: "1.0.0"
  contact:
    name: "Jehyun Kim"
servers:
  - url: "http://localhost:4300/api"
    description: "로컬 개발 서버"     

tags:
  - name: "1. Time Policy Management"
    description: "시간 정책 (스케쥴 및 공휴일) 관리"
  - name: "2. Security Level Management"
    description: "보안 등급(Clearance) 및 임계값(Threshold) 관리"
  - name: "3. Access Point Management"
    description: "출입 포인트 관리 (보안 설정, 그룹핑, 장비 CRUD 통합)"
  - name: "4. Access Rules"
    description: "출입 규칙(Where + When) 정의 및 우선순위 관리"
  - name: "5. Personnels"
    description: "출입 주체(직원/방문객) 관리"
  - name: "6. Authentication"
    description: "인증 규칙 및 수단(Credential) 관리"
  - name: "7. Access Grants"
    description: "권한 부여 및 이력"
  - name: "8. Interlocks"
    description: "인터락(Man-trap) 연동 제어"

paths:
  # ==========================================
  # 1. Time Policy Management
  # ==========================================
  /time-schedules:
    get:
      tags: ["1. Time Policy Management"]
      summary: "시간 스케쥴 목록 조회"
      description: |
        조건에 맞는 시간 스케쥴 목록을 조회합니다.<br>
        모든 요일(7개)과 정의된 공휴일 타입에 대한 상세 설정이 포함되어 반환됩니다.<br>
        공휴일 슬롯(예: HOL1...)에는 매핑된 공휴일의 상세 정보(이름, 날짜 목록 등)가 포함됩니다.<br>
        페이지네이션, 정렬 및 다양한 필터링(이름, 코드, 설명, 활성화 여부)을 지원합니다.
      parameters:
        - name: "organizationId"
          in: "query"
          description: "조직 ID 필터 (관리자용, 일반 사용자는 자동 고정)"
          schema:
            type: "string"
            format: "uuid"
        - name: "name"
          in: "query"
          description: "시간 스케쥴 이름 검색 (부분 일치)"
          schema:
            type: "string"
        - name: "description"
          in: "query"
          description: "시간 스케쥴 설명 검색 (부분 일치)"
          schema:
            type: "string"
        - name: "code"
          in: "query"
          description: "시간 스케쥴 코드 검색 (일치)"
          schema:
            type: "string"
        - name: "isActive"
          in: "query"
          description: "활성화 여부 필터 (true: 활성, false: 비활성, 미입력: 전체)"
          schema:
            type: "boolean"
        - name: "page"
          in: "query"
          description: "페이지 번호 (0부터 시작). 값을 입력하지 않으면 기본값(0)이 적용됩니다."
          schema:
            type: "integer"
            default: 0
        - name: "size"
          in: "query"
          description: |
            페이지 당 항목 수. 값을 입력하지 않으면 기본값(1000)이 적용됩니다.<br>
            (주의: 데이터가 많을 경우, 한 번에 너무 많은 항목을 조회하면 응답 속도가 느려질 수 있습니다.)
          schema:
            type: "integer"
            default: 1000
        - name: "sort"
          in: "query"
          description: |
            정렬 기준 (형식: 필드명,정렬방향)<br>
            예: createdAt,desc (최신순), name,asc (이름순)<br>
            다중 정렬 가능
          schema:
            type: "array"
            items:
              type: "string"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimeScheduleListResponse"
              examples:
                fullExample:
                  summary: "다양한 스케쥴 유형 및 공휴일 매핑 포함 예시"
                  value:
                    content:
                      - id: "123e4567-e89b-12d3-a456-426614174001"
                        name: "평일 근무시간 (커스텀)"
                        description: "평일 09:00 ~ 12:00, 13:00 ~ 18:00 근무"
                        code: "SCH-001"
                        details:
                          - dayOfWeek: "MON"
                            type: "CUSTOM"
                            timeSlots:
                              - startTime: "09:00:00"
                                endTime: "12:00:00"
                              - startTime: "13:00:00"
                                endTime: "18:00:00"
                          - dayOfWeek: "TUE"
                            type: "CUSTOM"
                            timeSlots:
                              - startTime: "09:00:00"
                                endTime: "12:00:00"
                              - startTime: "13:00:00"
                                endTime: "18:00:00"
                          - dayOfWeek: "WED"
                            type: "CUSTOM"
                            timeSlots:
                              - startTime: "09:00:00"
                                endTime: "12:00:00"
                              - startTime: "13:00:00"
                                endTime: "18:00:00"
                          - dayOfWeek: "THU"
                            type: "CUSTOM"
                            timeSlots:
                              - startTime: "09:00:00"
                                endTime: "12:00:00"
                              - startTime: "13:00:00"
                                endTime: "18:00:00"
                          - dayOfWeek: "FRI"
                            type: "CUSTOM"
                            timeSlots:
                              - startTime: "09:00:00"
                                endTime: "12:00:00"
                              - startTime: "13:00:00"
                                endTime: "18:00:00"
                          - dayOfWeek: "SAT"
                            type: "ALWAYS_DENIED"
                            timeSlots: []
                          - dayOfWeek: "SUN"
                            type: "ALWAYS_DENIED"
                            timeSlots: []
                          - dayOfWeek: "HOL1"
                            type: "ALWAYS_DENIED"
                            holiday:
                              id: "holiday-uuid-1"
                              name: "신정"
                              dates: ["2024-01-01"]
                            timeSlots: []
                          - dayOfWeek: "HOL2"
                            type: "ALWAYS_DENIED"
                            holiday:
                              id: "holiday-uuid-2"
                              name: "설날 연휴"
                              dates: ["2024-02-09", "2024-02-10", "2024-02-11", "2024-02-12"]
                            timeSlots: []
                          - dayOfWeek: "HOL3"
                            type: "ALWAYS_DENIED"
                            holiday:
                              id: "holiday-uuid-3"
                              name: "삼일절"
                              dates: ["2024-03-01"]
                            timeSlots: []
                        isActive: true
                        createdAt: "2024-01-01T09:00:00Z"
                        updatedAt: "2024-01-01T09:00:00Z"
                    page:
                      size: 20
                      page: 0
                      totalElements: 1
                      totalPages: 1
                      isLast: true
                      hasNext: false

    post:
      tags: ["1. Time Policy Management"]
      summary: "시간 스케쥴 생성"
      description: |
        새로운 시간 스케쥴을 생성합니다.<br>
        생성 시 반드시 모든 요일(MON~SUN)에 대한 설정이 포함되어야 하며, 필요한 공휴일 타입(HOL...)을 추가로 설정할 수 있습니다.<br>
        공휴일 타입의 경우, 사전에 등록된 공휴일 ID(id)를 매핑하여 등록할 수 있습니다.<br>
        
        **유니크 제약 조건:**<br>
        - `name`: 조직(`organizationId`) 내에서 유일해야 합니다.<br>
        - `code`: 조직(`organizationId`) 내에서 유일해야 합니다.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TimeScheduleRequest"
            examples:
              createScheduleExample:
                summary: "평일 근무(09-18) 및 공휴일 휴무 설정 입력 예시"
                value:
                  name: "일반 평일 근무"
                  description: "월~금 09:00~18:00 근무 (점심시간 12:00~13:00 제외), 주말 및 공휴일 출입 불가"
                  code: "SCH-REGULAR-01"
                  details:
                    - dayOfWeek: "MON"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:00:00"
                          endTime: "12:00:00"
                        - startTime: "13:00:00"
                          endTime: "18:00:00"
                    - dayOfWeek: "TUE"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:00:00"
                          endTime: "12:00:00"
                        - startTime: "13:00:00"
                          endTime: "18:00:00"
                    - dayOfWeek: "WED"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:00:00"
                          endTime: "12:00:00"
                        - startTime: "13:00:00"
                          endTime: "18:00:00"
                    - dayOfWeek: "THU"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:00:00"
                          endTime: "12:00:00"
                        - startTime: "13:00:00"
                          endTime: "18:00:00"
                    - dayOfWeek: "FRI"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:00:00"
                          endTime: "12:00:00"
                        - startTime: "13:00:00"
                          endTime: "18:00:00"
                    - dayOfWeek: "SAT"
                      type: "ALWAYS_DENIED"
                      timeSlots: []
                    - dayOfWeek: "SUN"
                      type: "ALWAYS_DENIED"
                      timeSlots: []
                    - dayOfWeek: "HOL1"
                      type: "ALWAYS_DENIED"
                      timeSlots: []
                      holidayId: "holiday-uuid-152"
                    - dayOfWeek: "HOL2"
                      type: "ALWAYS_ALLOWED"
                      timeSlots: []
                      holidayId: "holiday-uuid-221"
      responses:
        '200':
          description: "생성됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimeSchedule"
              examples:
                createdResponse:
                  summary: "생성된 시간 스케쥴 응답"
                  value:
                    id: "123e4567-e89b-12d3-a456-426614174001"
                    name: "일반 평일 근무"
                    description: "월~금 09:00~18:00 근무 (점심시간 12:00~13:00 제외), 주말 및 공휴일 출입 불가"
                    code: "SCH-REGULAR-01"
                    details:
                      - dayOfWeek: "MON"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "TUE"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "WED"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "THU"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "FRI"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "SAT"
                        type: "ALWAYS_DENIED"
                        timeSlots: []
                      - dayOfWeek: "SUN"
                        type: "ALWAYS_DENIED"
                        timeSlots: []
                      - dayOfWeek: "HOL1"
                        type: "ALWAYS_DENIED"
                        holiday:
                          id: "holiday-uuid-152"
                          name: "신정"
                          dates: ["2024-01-01"]
                        timeSlots: []
                    isActive: true
                    createdAt: "2024-01-01T09:00:00Z"
                    updatedAt: "2024-01-01T09:00:00Z"
        '409':
          $ref: "#/components/responses/Conflict"

  /time-schedules/{id}:
    get:
      tags: ["1. Time Policy Management"]
      summary: "시간 스케쥴 단건 조회"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimeSchedule"
              examples:
                singleSchedule:
                  summary: "단일 스케쥴 조회 응답"
                  value:
                    id: "123e4567-e89b-12d3-a456-426614174001"
                    name: "일반 평일 근무"
                    description: "월~금 09:00~18:00 근무 (점심시간 12:00~13:00 제외), 주말 및 공휴일 출입 불가"
                    code: "SCH-REGULAR-01"
                    details:
                      - dayOfWeek: "MON"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "TUE"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "WED"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "THU"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "FRI"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:00:00"
                            endTime: "12:00:00"
                          - startTime: "13:00:00"
                            endTime: "18:00:00"
                      - dayOfWeek: "SAT"
                        type: "ALWAYS_DENIED"
                        timeSlots: []
                      - dayOfWeek: "SUN"
                        type: "ALWAYS_DENIED"
                        timeSlots: []
                      - dayOfWeek: "HOL1"
                        type: "ALWAYS_DENIED"
                        holiday:
                          id: "holiday-uuid-1"
                          name: "신정"
                          dates: ["2024-01-01"]
                        timeSlots: []
                    isActive: true
                    createdAt: "2024-01-01T09:00:00Z"
                    updatedAt: "2024-01-01T09:00:00Z"
        '404':
          $ref: "#/components/responses/NotFound"

    put:
      tags: ["1. Time Policy Management"]
      summary: "시간 스케쥴 수정"
      description: |
        시간 스케쥴 정보를 전체 수정합니다 (Replacement).
        
        **주의사항:**
        - 기존 데이터를 요청 본문(Body)의 데이터로 **완전히 덮어씁니다.**
        - 따라서 `details` 리스트에 포함되지 않은 기존 설정(예: 기존에 존재하던 HOL4 설정 등)은 **삭제**됩니다.
        - 수정 시 유지하려는 모든 요일과 공휴일 설정을 포함해서 보내야 합니다.
        
        **유니크 제약 조건:**
        - `name`: 조직(`organizationId`) 내에서 유일해야 합니다. (자기 자신 제외)
        - `code`: 조직(`organizationId`) 내에서 유일해야 합니다. (자기 자신 제외)
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TimeScheduleRequest"
            examples:
              updateExample:
                summary: "시간 스케쥴 전체 수정 요청 예시"
                value:
                  name: "일반 평일 근무 (수정됨)"
                  description: "설명이 변경되었습니다. (09:30 출근)"
                  code: "SCH-REGULAR-01"
                  isActive: true
                  details:
                    - dayOfWeek: "MON"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:30:00"
                          endTime: "18:30:00"
                    - dayOfWeek: "TUE"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:30:00"
                          endTime: "18:30:00"
                    - dayOfWeek: "WED"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:30:00"
                          endTime: "18:30:00"
                    - dayOfWeek: "THU"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:30:00"
                          endTime: "18:30:00"
                    - dayOfWeek: "FRI"
                      type: "CUSTOM"
                      timeSlots:
                        - startTime: "09:30:00"
                          endTime: "18:30:00"
                    - dayOfWeek: "SAT"
                      type: "ALWAYS_DENIED"
                      timeSlots: []
                    - dayOfWeek: "SUN"
                      type: "ALWAYS_DENIED"
                      timeSlots: []
                    - dayOfWeek: "HOL1"
                      type: "ALWAYS_DENIED"
                      timeSlots: []
                      holidayId: "holiday-uuid-152"
      responses:
        '200':
          description: "수정됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimeSchedule"
              examples:
                updatedResponse:
                  summary: "수정된 시간 스케쥴 응답"
                  value:
                    id: "123e4567-e89b-12d3-a456-426614174001"
                    name: "일반 평일 근무 (수정됨)"
                    description: "설명이 변경되었습니다. (09:30 출근)"
                    code: "SCH-REGULAR-01"
                    details:
                      - dayOfWeek: "MON"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:30:00"
                            endTime: "18:30:00"
                      - dayOfWeek: "TUE"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:30:00"
                            endTime: "18:30:00"
                      - dayOfWeek: "WED"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:30:00"
                            endTime: "18:30:00"
                      - dayOfWeek: "THU"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:30:00"
                            endTime: "18:30:00"
                      - dayOfWeek: "FRI"
                        type: "CUSTOM"
                        timeSlots:
                          - startTime: "09:30:00"
                            endTime: "18:30:00"
                      - dayOfWeek: "SAT"
                        type: "ALWAYS_DENIED"
                        timeSlots: []
                      - dayOfWeek: "SUN"
                        type: "ALWAYS_DENIED"
                        timeSlots: []
                      - dayOfWeek: "HOL1"
                        type: "ALWAYS_DENIED"
                        holiday:
                          id: "holiday-uuid-152"
                          name: "신정"
                          dates: ["2024-01-01"]
                        timeSlots: []
                    isActive: true
                    createdAt: "2024-01-01T09:00:00Z"
                    updatedAt: "2024-01-10T15:00:00Z"
        '404':
          $ref: "#/components/responses/NotFound"
        '409':
          $ref: "#/components/responses/Conflict"

    delete:
      tags: ["1. Time Policy Management"]
      summary: "시간 스케쥴 삭제"
      description: |
        시간 스케쥴을 삭제합니다.
        서버 정책에 따라 논리적 삭제(Soft Delete) 또는 물리적 삭제(Hard Delete)가 수행될 수 있으며, 결과에 해당 정보가 포함됩니다.
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "삭제 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
              examples:
                softDeleteExample:
                  summary: "논리적 삭제(Soft Delete) 결과 예시"
                  value:
                    id: "123e4567-e89b-12d3-a456-426614174000"
                    isSoftDeleted: true
                    isHardDeleted: false
        '404':
          $ref: "#/components/responses/NotFound"

  /holidays:
    get:
      tags: ["1. Time Policy Management"]
      summary: "공휴일 목록 조회"
      description: |
        조건에 맞는 공휴일 목록을 조회합니다.
        페이지네이션, 정렬 및 다양한 필터링(이름, 코드, 설명, 반복 여부 등)을 지원합니다.
        
        **참고:** `isRecurring`이 `true`인 공휴일의 경우, 서버 설정(예: 현재 연도 전후 1년)에 따라 자동으로 계산된 연도가 포함된 날짜 목록(`items`)이 반환됩니다.
      parameters:
        - name: "organizationId"
          in: "query"
          description: "조직 ID 필터"
          schema:
            type: "string"
            format: "uuid"
        - name: "name"
          in: "query"
          description: "공휴일 이름 검색 (부분 일치)"
          schema:
            type: "string"
        - name: "description"
          in: "query"
          description: "공휴일 설명 검색 (부분 일치)"
          schema:
            type: "string"
        - name: "code"
          in: "query"
          description: "공휴일 코드 검색 (일치)"
          schema:
            type: "string"
        - name: "isRecurring"
          in: "query"
          description: "매년 반복 여부 필터"
          schema:
            type: "boolean"
        - name: "isActive"
          in: "query"
          description: "활성화 여부 필터 (true: 활성, false: 비활성, 미입력: 전체)"
          schema:
            type: "boolean"
        - name: "page"
          in: "query"
          description: "페이지 번호 (0부터 시작). 값을 입력하지 않으면 기본값(0)이 적용됩니다."
          schema:
            type: "integer"
            default: 0
        - name: "size"
          in: "query"
          description: |
            페이지 당 항목 수.
            값을 입력하지 않으면 기본값(1000)이 적용됩니다.
          schema:
            type: "integer"
            default: 1000
        - name: "sort"
          in: "query"
          description: |
            정렬 기준 (형식: 필드명,정렬방향)
            예: holidayDate,asc (날짜순), name,asc (이름순)
            다중 정렬 가능
          schema:
            type: "array"
            items:
              type: "string"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HolidayListResponse"
              examples:
                holidayListExample:
                  summary: "공휴일 목록 조회 결과 예시"
                  value:
                    content:
                      - id: "holiday-uuid-1"
                        name: "신정 (매년 반복)"
                        description: "매년 1월 1일"
                        code: "HOL-001"
                        isRecurring: true
                        items:
                          - id: "item-gen-1"
                            holidayDate: "2025-01-01"
                            isSubstitute: false
                        isActive: true
                      - id: "holiday-uuid-2"
                        name: "2024년 설날 연휴"
                        description: "2024년 설날 및 대체공휴일"
                        code: "HOL-2024-SEOL"
                        isRecurring: false
                        items:
                          - id: "item-uuid-3"
                            holidayDate: "2024-02-09"
                            isSubstitute: false
                          - id: "item-uuid-4"
                            holidayDate: "2024-02-10"
                            isSubstitute: false
                          - id: "item-uuid-5"
                            holidayDate: "2024-02-11"
                            isSubstitute: false
                          - id: "item-uuid-6"
                            holidayDate: "2024-02-12"
                            isSubstitute: true
                        isActive: true
                    page:
                      size: 20
                      page: 0
                      totalElements: 2
                      totalPages: 1
                      isLast: true
                      hasNext: false

    post:
      tags: ["1. Time Policy Management"]
      summary: "공휴일 등록"
      description: |
        새로운 공휴일 그룹을 등록합니다.
        
        **날짜 입력 규칙:**
        - `isRecurring: true` (매년 반복): `holidayDate`에 **"MM-DD"** 형식 입력 (예: "01-01")
        - `isRecurring: false` (단발성): `holidayDate`에 **"YYYY-MM-DD"** 형식 입력 (예: "2024-02-10")
        
        **유니크 제약 조건:**
        - `name`: 조직(`organizationId`) 내에서 유일해야 합니다.
        - `code`: 조직(`organizationId`) 내에서 유일해야 합니다.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HolidayRequest"
            examples:
              recurringHoliday:
                summary: "매년 반복되는 공휴일(신정) 등록 예시"
                value:
                  name: "신정"
                  description: "매년 1월 1일은 신정입니다."
                  code: "HOL-001"
                  isRecurring: true
                  items:
                    - holidayDate: "01-01"
                      isSubstitute: false
              oneTimeHoliday:
                summary: "특정 연도 공휴일(설날) 등록 예시"
                value:
                  name: "2024년 설날"
                  description: "2024년 갑진년 설날 연휴"
                  code: "HOL-2024-SEOL"
                  isRecurring: false
                  items:
                    - holidayDate: "2024-02-09"
                    - holidayDate: "2024-02-10"
                    - holidayDate: "2024-02-11"
                    - holidayDate: "2024-02-12"
                      isSubstitute: true
      responses:
        '200':
          description: "생성됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Holiday"
              examples:
                createdResponse:
                  summary: "생성된 공휴일 응답"
                  value:
                    id: "holiday-uuid-1"
                    name: "신정"
                    description: "매년 1월 1일은 신정입니다."
                    code: "HOL-001"
                    isRecurring: true
                    items:
                      - id: "item-gen-1"
                        holidayDate: "2024-01-01"
                        isSubstitute: false
                      - id: "item-gen-2"
                        holidayDate: "2025-01-01"
                        isSubstitute: false
                    isActive: true
        '409':
          $ref: "#/components/responses/Conflict"

  /holidays/{id}:
    get:
      tags: ["1. Time Policy Management"]
      summary: "공휴일 단건 조회"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Holiday"
              examples:
                singleHoliday:
                  summary: "단건 조회 예시"
                  value:
                    id: "holiday-uuid-1"                    
                    name: "신정"
                    description: "매년 1월 1일"
                    code: "HOL-001"
                    isRecurring: true
                    isActive: true
                    items:
                      - id: "item-gen-1"
                        holidayDate: "2024-01-01"
                        isSubstitute: false
        '404':
          $ref: "#/components/responses/NotFound"

    put:
      tags: ["1. Time Policy Management"]
      summary: "공휴일 수정"
      description: |
        공휴일 정보를 전체 수정합니다 (Replacement).
        
        **주의사항:**
        - 기존 데이터를 요청 본문(Body)의 데이터로 **완전히 덮어씁니다.**
        - `items` 리스트도 새로 전달된 목록으로 교체됩니다.
        
        **날짜 입력 규칙 (isRecurring 변경 시 주의):**
        - `isRecurring`을 `true`로 설정/변경 시: `holidayDate`는 **"MM-DD"** 형식이어야 합니다.
        - `isRecurring`을 `false`로 설정/변경 시: `holidayDate`는 **"YYYY-MM-DD"** 형식이어야 합니다.
        
        **유니크 제약 조건:**
        - `name`: 조직(`organizationId`) 내에서 유일해야 합니다. (자기 자신 제외)
        - `code`: 조직(`organizationId`) 내에서 유일해야 합니다. (자기 자신 제외)
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HolidayRequest"
            examples:
              updateExample:
                summary: "공휴일 수정 요청 예시"
                value:
                  name: "신정 (수정됨)"
                  description: "설명 변경됨"
                  code: "HOL-001"
                  isRecurring: true
                  isActive: true
                  items:
                    - holidayDate: "01-01"
                      isSubstitute: false
      responses:
        '200':
          description: "수정됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Holiday"
              examples:
                updatedResponse:
                  summary: "수정된 공휴일 응답"
                  value:
                    id: "holiday-uuid-1"
                    name: "신정 (수정됨)"
                    description: "설명 변경됨"
                    code: "HOL-001"
                    isRecurring: true
                    items:
                      - id: "item-gen-2"
                        holidayDate: "2025-01-01"
                        isSubstitute: false
                    isActive: true
        '404':
          $ref: "#/components/responses/NotFound"
        '409':
          $ref: "#/components/responses/Conflict"

    delete:
      tags: ["1. Time Policy Management"]
      summary: "공휴일 삭제"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "삭제 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
              examples:
                deleteResponse:
                  summary: "공휴일 삭제 결과"
                  value:
                    id: "holiday-uuid-1"
                    isSoftDeleted: true
                    isHardDeleted: false
        '404':
          $ref: "#/components/responses/NotFound"


  # ==========================================
  # 2. Security Level Management
  # ==========================================
  /security-clearances:
    get:
      tags: ["2. Security Level Management"]
      summary: "보안 등급(Security Clearance) 목록 조회"
      description: |
        사람(Personnel)에게 부여할 수 있는 보안 등급(인가 등급) 목록을 조회합니다.<br>
        `accessLevel`이 높을수록 더 높은 보안 임계값(Threshold)을 가진 문을 통과할 수 있습니다.
      parameters:
        - name: "organizationId"
          in: "query"
          description: "조직 ID"
          schema:
            type: "string"
            format: "uuid"
        - name: "name"
          in: "query"
          description: "등급명 검색 (부분 일치)"
          schema:
            type: "string"
        - name: "accessLevel"
          in: "query"
          description: "출입 권한 레벨 일치 검색"
          schema:
            type: "integer"
        - name: "antipassbackLevel"
          in: "query"
          description: "안티패스백 레벨 일치 검색"
          schema:
            type: "integer"
        - name: "armingLevel"
          in: "query"
          description: "경비 레벨 일치 검색"
          schema:
            type: "integer"
        - name: "isActive"
          in: "query"
          schema:
            type: "boolean"
        - name: "page"
          in: "query"
          schema:
            type: "integer"
            default: 0
        - name: "size"
          in: "query"
          schema:
            type: "integer"
            default: 1000
        - name: "sort"
          in: "query"
          description: |
            정렬 기준 (형식: 필드명,정렬방향)<br>
            예: accessLevel,desc (높은 등급순), name,asc (이름순)
          schema:
            type: "array"
            items:
              type: "string"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  content:
                    type: "array"
                    items:
                      $ref: "#/components/schemas/SecurityClearance"
                  page:
                    $ref: "#/components/schemas/PageMetadata"

    post:
      tags: ["2. Security Level Management"]
      summary: "보안 등급 생성"
      description: |
        새로운 보안 등급을 생성합니다.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecurityClearanceRequest"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityClearance"
        '409':
          $ref: "#/components/responses/Conflict"

  /security-clearances/{id}:
    get:
      tags: ["2. Security Level Management"]
      summary: "보안 등급 단건 조회"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityClearance"
        '404':
          $ref: "#/components/responses/NotFound"

    put:
      tags: ["2. Security Level Management"]
      summary: "보안 등급 수정"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecurityClearanceRequest"
      responses:
        '200':
          description: "수정됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityClearance"
        '404':
          $ref: "#/components/responses/NotFound"
        '409':
          $ref: "#/components/responses/Conflict"

    delete:
      tags: ["2. Security Level Management"]
      summary: "보안 등급 삭제"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "삭제 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        '404':
          $ref: "#/components/responses/NotFound"

  /security-thresholds:
    get:
      tags: ["2. Security Level Management"]
      summary: "보안 임계값(Security Threshold) 목록 조회"
      description: |
        출입문(Access Point)에 설정할 수 있는 최소 보안 요구사항 목록을 조회합니다.<br>
        `minAccessLevel`보다 낮은 `accessLevel`을 가진 사람은 출입이 거부됩니다.<br>
      parameters:
        - name: "organizationId"
          in: "query"
          schema:
            type: "string"
            format: "uuid"
        - name: "name"
          in: "query"
          description: "임계값 이름 검색 (부분 일치)"
          schema:
            type: "string"
        - name: "minAccessLevel"
          in: "query"
          description: "최소 출입 레벨 일치 검색"
          schema:
            type: "integer"
        - name: "minAntipassbackLevel"
          in: "query"
          description: "최소 안티패스백 레벨 일치 검색"
          schema:
            type: "integer"
        - name: "minArmingLevel"
          in: "query"
          description: "최소 경비 레벨 일치 검색"
          schema:
            type: "integer"
        - name: "isActive"
          in: "query"
          schema:
            type: "boolean"
        - name: "page"
          in: "query"
          schema:
            type: "integer"
            default: 0
        - name: "size"
          in: "query"
          schema:
            type: "integer"
            default: 1000
        - name: "sort"
          in: "query"
          description: |
            정렬 기준 (형식: 필드명,정렬방향)<br>
            예: minAccessLevel,asc (낮은 레벨순), name,asc
          schema:
            type: "array"
            items:
              type: "string"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  content:
                    type: "array"
                    items:
                      $ref: "#/components/schemas/SecurityThreshold"
                  page:
                    $ref: "#/components/schemas/PageMetadata"

    post:
      tags: ["2. Security Level Management"]
      summary: "보안 임계값 생성"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecurityThresholdRequest"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityThreshold"
        '409':
          $ref: "#/components/responses/Conflict"

  /security-thresholds/{id}:
    get:
      tags: ["2. Security Level Management"]
      summary: "보안 임계값 단건 조회"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityThreshold"
        '404':
          $ref: "#/components/responses/NotFound"

    put:
      tags: ["2. Security Level Management"]
      summary: "보안 임계값 수정"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecurityThresholdRequest"
      responses:
        '200':
          description: "수정됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityThreshold"
        '404':
          $ref: "#/components/responses/NotFound"
        '409':
          $ref: "#/components/responses/Conflict"

    delete:
      tags: ["2. Security Level Management"]
      summary: "보안 임계값 삭제"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "삭제 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        '404':
          $ref: "#/components/responses/NotFound"

  # ==========================================
  # 3. Access Point Management
  # ==========================================
  /access-points:
    get:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트(Access Point) 목록 조회"
      description: |
        물리적 출입 포인트 목록을 조회합니다.<br>
        상위 공간(`site`, `facility`, `sector`) 및 구역(`area`)별 조회나 타입(`type`)별 필터링을 지원합니다.
      parameters:
        - name: "organizationId"
          in: "query"
          schema:
            type: "string"
            format: "uuid"
        - name: "siteId"
          in: "query"
          description: "소속 사이트 ID 필터"
          schema:
            type: "string"
            format: "uuid"
        - name: "facilityId"
          in: "query"
          description: "소속 시설물(건물) ID 필터"
          schema:
            type: "string"
            format: "uuid"
        - name: "sectorId"
          in: "query"
          description: "소속 구획(층) ID 필터"
          schema:
            type: "string"
            format: "uuid"
        - name: "areaId"
          in: "query"
          description: "소속 구역 ID 필터"
          schema:
            type: "string"
            format: "uuid"
        - name: "name"
          in: "query"
          description: "출입 포인트명 검색 (부분 일치)"
          schema:
            type: "string"
        - name: "type"
          in: "query"
          description: "출입 포인트 타입 필터"
          schema:
            type: "string"
            enum: ["DOOR", "GATE_DOOR", "TURNSTILE", "ELEVATOR", "SPEED_GATE", "BARRIER", "SLIDING", "SHUTTER", "BOLLARD"]
        - name: "isActive"
          in: "query"
          schema:
            type: "boolean"
        - name: "page"
          in: "query"
          schema:
            type: "integer"
            default: 0
        - name: "size"
          in: "query"
          schema:
            type: "integer"
            default: 1000
        - name: "sort"
          in: "query"
          description: |
            정렬 기준 (형식: 필드명,정렬방향)<br>
            예: name,asc (이름순), createdAt,desc (최신순)<br>
            다중 정렬 가능
          schema:
            type: "array"
            items:
              type: "string"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  content:
                    type: "array"
                    items:
                      $ref: "#/components/schemas/AccessPoint"
                  page:
                    $ref: "#/components/schemas/PageMetadata"
    post:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 생성"
      description: |
        새로운 물리적 출입 포인트을 생성합니다.
        
        **주요 특징:**
        - **공간 정보:** `siteId`, `facilityId`, `sectorId`, `areaId` 중 하나 이상을 입력하여 위치를 지정할 수 있습니다. (모두 선택 사항)
        - **보안 설정:** 입실/퇴실에 대한 인증 규칙(`AuthenticationRule`)과 최소 보안 임계값(`SecurityThreshold`)을 직접 설정합니다.
        - **장비 연결:** `devices` 배열을 통해 입/출 리더기나 컨트롤러 등 물리적 장비를 즉시 연결할 수 있습니다.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AccessPointRequest"
      responses:
        '200':
          description: "생성됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessPoint"
        '409':
          $ref: "#/components/responses/Conflict"

  /access-points/types:
    get:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 타입 목록 조회"
      description: |
        시스템에서 지원하는 출입 포인트 타입(Enum) 목록을 조회합니다.<br>
        출입 포인트 타입(Enum) 목록:<br>
        `"DOOR", "GATE_DOOR", "TURNSTILE", "ELEVATOR", "SPEED_GATE", "BARRIER", "SLIDING", "SHUTTER", "BOLLARD"`<br>
        UI 드롭다운(Select Box) 구성에 사용됩니다.<br>
        반환 예시: <br>
        `[{ "code": "DOOR", "label": "일반 출입문" }, { "code": "TURNSTILE", "label": "스피드 게이트" }]`
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  $ref: "#/components/schemas/AccessPointType"  

  /access-points/{id}:
    get:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 단건 조회"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessPoint"
        '404':
          $ref: "#/components/responses/NotFound"

    put:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 수정"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AccessPointRequest"
      responses:
        '200':
          description: "수정됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessPoint"
        '404':
          $ref: "#/components/responses/NotFound"
        '409':
          $ref: "#/components/responses/Conflict"

    delete:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 삭제"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "삭제 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        '404':
          $ref: "#/components/responses/NotFound"

  /access-point-groups:
    get:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 그룹 목록 조회"
      description: |
        출입 포인트 그룹 목록을 조회합니다.<br>
        그룹 이름 검색 외에 **특정 출입 포인트가 포함된 그룹**을 찾는 기능이 제공됩니다.
      parameters:
        - name: "organizationId"
          in: "query"
          schema:
            type: "string"
            format: "uuid"
        - name: "name"
          in: "query"
          description: "그룹 이름 검색 (부분 일치)"
          schema:
            type: "string"
        - name: "accessPointId"
          in: "query"
          description: "특정 출입 포인트 ID가 포함된 그룹 검색"
          schema:
            type: "string"
            format: "uuid"
        - name: "accessPointName"
          in: "query"
          description: "특정 출입 포인트 이름(부분 일치)이 포함된 그룹 검색"
          schema:
            type: "string"
        - name: "isActive"
          in: "query"
          schema:
            type: "boolean"
        - name: "page"
          in: "query"
          schema:
            type: "integer"
            default: 0
        - name: "size"
          in: "query"
          schema:
            type: "integer"
            default: 1000
        - name: "sort"
          in: "query"
          description: |
            정렬 기준 (형식: 필드명,정렬방향)<br>
            예: name,asc (이름순), createdAt,desc (최신순)<br>
            다중 정렬 가능
          schema:
            type: "array"
            items:
              type: "string"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  content:
                    type: "array"
                    items:
                      $ref: "#/components/schemas/AccessPointGroup"
                  page:
                    $ref: "#/components/schemas/PageMetadata"

    post:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 그룹 생성"
      description: |
        새로운 출입 포인트 그룹을 생성합니다.<br>
        `accessPointIds` 목록을 포함하여 그룹에 속할 출입 포인트를 한 번에 지정할 수 있습니다.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AccessPointGroupRequest"
      responses:
        '200':
          description: "생성됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessPointGroup"
        '409':
          $ref: "#/components/responses/Conflict"

  /access-point-groups/{id}:
    get:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 그룹 단건 조회"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessPointGroup"
        '404':
          $ref: "#/components/responses/NotFound"

    put:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 그룹 수정"
      description: |
        출입 포인트 그룹 정보를 전체 수정합니다.<br>
        `accessPointIds` 목록을 새로 전달하면, 기존 매핑은 제거되고 새로운 목록으로 교체됩니다.
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AccessPointGroupRequest"
      responses:
        '200':
          description: "수정됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessPointGroup"
        '404':
          $ref: "#/components/responses/NotFound"
        '409':
          $ref: "#/components/responses/Conflict"

    delete:
      tags: ["3. Access Point Management"]
      summary: "출입 포인트 그룹 삭제"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "삭제 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        '404':
          $ref: "#/components/responses/NotFound"

  # ==========================================
  # 4. Access Rules (Priority-Based)
  # ==========================================
  /access-rules:
    get:
      tags: ["4. Access Rules"]
      summary: "출입 규칙(Access Rule) 목록 조회"
      description: |
        출입 규칙 목록을 조회합니다.<br>
        `priority`가 높을수록 강력한 규칙으로 간주됩니다. (High Priority Wins)
      parameters:
        - name: "organizationId"
          in: "query"
          description: "조직 ID 필터 (관리자용)"
          schema:
            type: "string"
            format: "uuid"
        - name: "name"
          in: "query"
          description: "규칙명 검색"
          schema:
            type: "string"
        - name: "isActive"
          in: "query"
          schema:
            type: "boolean"
        - name: "page"
          in: "query"
          schema:
            type: "integer"
            default: 0
        - name: "size"
          in: "query"
          schema:
            type: "integer"
            default: 1000
        - name: "sort"
          in: "query"
          description: "정렬 기준 (예: priority,desc)"
          schema:
            type: "array"
            items:
              type: "string"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  content:
                    type: "array"
                    items:
                      $ref: "#/components/schemas/AccessRule"
                  page:
                    $ref: "#/components/schemas/PageMetadata"

    post:
      tags: ["4. Access Rules"]
      summary: "출입 규칙 생성"
      description: |
        새로운 출입 규칙을 생성합니다.<br>
        **우선순위(Priority):** 0~255 사이의 정수. 숫자가 클수록 높은 권한을 가집니다.<br>
        **매핑:** 하나의 규칙에 [개별 출입문 + 스케줄] 또는 [출입문 그룹 + 스케줄] 조합을 여러 개 담을 수 있습니다.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AccessRuleRequest"
      responses:
        '200':
          description: "생성됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessRule"
        '409':
          $ref: "#/components/responses/Conflict"

  /access-rules/{id}:
    get:
      tags: ["4. Access Rules"]
      summary: "출입 규칙 단건 조회"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessRule"
        '404':
          $ref: "#/components/responses/NotFound"

    put:
      tags: ["4. Access Rules"]
      summary: "출입 규칙 수정"
      description: |
        출입 규칙을 수정합니다. 헤더 정보와 상세 항목(items)을 모두 포함하여 전체 업데이트(Replacement)합니다.
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AccessRuleRequest"
      responses:
        '200':
          description: "수정됨"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccessRule"
        '404':
          $ref: "#/components/responses/NotFound"
        '409':
          $ref: "#/components/responses/Conflict"

    delete:
      tags: ["4. Access Rules"]
      summary: "출입 규칙 삭제"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        '200':
          description: "삭제 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        '404':
          $ref: "#/components/responses/NotFound"

components:
  responses:
    BadRequest:
      description: "잘못된 요청 (유효성 검사 실패 등)"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: "인증 실패 (토큰 없음/만료)"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Forbidden:
      description: "권한 없음"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: "리소스를 찾을 수 없음"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: "데이터 충돌 (중복 등)"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    InternalServerError:
      description: "서버 내부 오류"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
  schemas:
    # ----------------------------------------------------
    # Common Schemas
    # ----------------------------------------------------
    PageMetadata:
      type: "object"
      properties:
        size:
          type: "integer"
          description: "페이지 당 항목 수"
          example: 20
        page:
          type: "integer"
          description: "현재 페이지 번호 (0부터 시작)"
          example: 0
        totalElements:
          type: "integer"
          description: "전체 항목 수"
          example: 100
        totalPages:
          type: "integer"
          description: "전체 페이지 수"
          example: 5
        isLast:
          type: "boolean"
          description: "마지막 페이지 여부"
          example: false
        hasNext:
          type: "boolean"
          description: "다음 페이지 존재 여부"
          example: true

    DeleteResult:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
          description: "삭제된 리소스의 ID"
        isSoftDeleted:
          type: "boolean"
          description: "논리적 삭제(Soft Delete) 여부. true면 DB에는 남아있지만 삭제된 것으로 처리됨."
        isHardDeleted:
          type: "boolean"
          description: "물리적 삭제(Hard Delete) 여부. true면 DB에서 완전히 제거됨."

    ErrorResponse:
      type: "object"
      properties:
        errorCode:
          type: "string"
          description: "에러 코드 (예: DUPLICATE_ENTRY, RESOURCE_NOT_FOUND)"
          example: "INVALID_REQUEST"
        errorMessage:
          type: "string"
          description: "에러 메시지"
          example: "잘못된 요청입니다."
        errorDetails:
          type: "object"
          description: "상세 에러 내용 (필드별 유효성 검사 실패 사유 등)"
          nullable: true

    # ----------------------------------------------------
    # 1. Time Policy Management
    # ----------------------------------------------------
    TimeScheduleListResponse:
      type: "object"
      properties:
        content:
          type: "array"
          items:
            $ref: "#/components/schemas/TimeSchedule"
        page:
          $ref: "#/components/schemas/PageMetadata"

    TimeSchedule:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        name:
          type: "string"
          example: "평일 근무시간"
        description:
          type: "string"
        code:
          type: "string"
        details:
          type: "array"
          description: "항상 모든 요일(MON~SUN)과 설정된 공휴일 타입의 상세 설정이 포함됩니다."
          items:
            $ref: "#/components/schemas/TimeScheduleDetail"
        isActive:
          type: "boolean"
        createdAt:
          type: "string"
          format: "date-time"
        updatedAt:
          type: "string"
          format: "date-time"

    TimeSlot:
      type: "object"
      properties:
        startTime:
          type: "string"
          description: "HH:mm:ss 형식"
          example: "09:00:00"
        endTime:
          type: "string"
          description: "HH:mm:ss 형식"
          example: "12:00:00"

    TimeScheduleDetail:
      type: "object"
      properties:
        dayOfWeek:
          type: "string"
          description: "요일 코드 (MON, TUE... SUN) 또는 공휴일 스케쥴 타입 (예: HOL1, HOL2...)"
          example: "MON"
        type:
          type: "string"
          description: "스케쥴 유형"
          enum: ["CUSTOM", "ALWAYS_ALLOWED", "ALWAYS_DENIED"]
        holiday:
          $ref: "#/components/schemas/HolidayReference"
          description: "dayOfWeek이 공휴일 타입(HOL...)인 경우 포함되는 공휴일 상세 정보"
        timeSlots:
          type: "array"
          description: "시간 구간 목록 (type가 'CUSTOM'일 때 필수)"
          items:
            $ref: "#/components/schemas/TimeSlot"
          nullable: true

    TimeScheduleDetailRequest:
      type: "object"
      required: ["dayOfWeek", "type"]
      properties:
        dayOfWeek:
          type: "string"
          description: "요일 코드 (MON, TUE... SUN) 또는 공휴일 스케쥴 타입 (예: HOL1, HOL2...)"
          example: "MON"
        type:
          type: "string"
          description: "스케쥴 유형"
          enum: ["CUSTOM", "ALWAYS_ALLOWED", "ALWAYS_DENIED"]
        holidayId:
          type: "string"
          format: "uuid"
          description: "dayOfWeek이 공휴일 타입(HOL...)인 경우 매핑할 공휴일 ID"
        timeSlots:
          type: "array"
          description: "시간 구간 목록 (type가 'CUSTOM'일 때 필수)"
          items:
            $ref: "#/components/schemas/TimeSlot"
          nullable: true

    TimeScheduleRequest:
      type: "object"
      required: ["name", "details"]
      properties:
        name:
          type: "string"
        description:
          type: "string"
        code:
          type: "string"
        details:
          type: "array"
          description: "모든 요일(MON~SUN)과 필요한 공휴일 타입(HOL...)에 대한 상세 설정 (최소 7개 필수)"
          minItems: 7
          items:
            $ref: "#/components/schemas/TimeScheduleDetailRequest"
        isActive:
          type: "boolean"
          default: true

    HolidayListResponse:
      type: "object"
      properties:
        content:
          type: "array"
          items:
            $ref: "#/components/schemas/Holiday"
        page:
          $ref: "#/components/schemas/PageMetadata"

    HolidayReference:
      type: "object"
      description: "스케쥴 응답 시 포함되는 공휴일 요약 정보"
      properties:
        id:
          type: "string"
          format: "uuid"
        name:
          type: "string"
          example: "설날 연휴"
        dates:
          type: "array"
          description: "해당 공휴일에 포함된 모든 날짜 목록"
          items:
            type: "string"
            format: "date"
            example: "2024-02-10"

    Holiday:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        name:
          type: "string"
        description:
          type: "string"
        code:
          type: "string"
        isRecurring:
          type: "boolean"
        items:
          type: "array"
          description: "공휴일에 포함된 날짜 목록"
          items:
            $ref: "#/components/schemas/HolidayItem"
        isActive:
          type: "boolean"

    HolidayItem:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        holidayDate:
          type: "string"
          description: "YYYY-MM-DD (isRecurring=false) 또는 MM-DD (isRecurring=true)"
          example: "2024-01-01"
        isSubstitute:
          type: "boolean"

    HolidayRequest:
      type: "object"
      required: ["name", "items"]
      properties:
        name:
          type: "string"
        description:
          type: "string"
        code:
          type: "string"
        isRecurring:
          type: "boolean"
          default: false
        items:
          type: "array"
          minItems: 1
          items:
            type: "object"
            required: ["holidayDate"]
            properties:
              holidayDate:
                type: "string"
                # YYYY-MM-DD 또는 MM-DD 형식을 모두 허용하는 정규식
                pattern: "^(\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])|(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01]))$"
                description: "날짜. isRecurring=true면 'MM-DD', false면 'YYYY-MM-DD' 형식"
                example: "01-01"
              isSubstitute:
                type: "boolean"
                default: false
        isActive:
          type: "boolean"
          default: true

    # ----------------------------------------------------
    # 2. Security Level Management
    # ----------------------------------------------------
    SecurityClearance:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        name:
          type: "string"
          example: "일반 임직원"
        description:
          type: "string"
          example: "대부분의 임직원에게 부여되는 기본 출입 권한 등급"
        accessLevel:
          type: "integer"
          description: "출입 권한 레벨 (1~255). 이 값이 문의 minAccessLevel보다 크거나 같아야 통과."
          example: 10
        antipassbackLevel:
          type: "integer"
          description: "안티패스백 면제 레벨 (1~255)"
          default: 1
        armingLevel:
          type: "integer"
          description: "경비(Arming) 설정 가능 레벨 (1~255)"
          default: 1
        isActive:
          type: "boolean"

    SecurityClearanceRequest:
      type: "object"
      required: ["name"]
      properties:
        name:
          type: "string"
          example: "일반 임직원"
        description:
          type: "string"
          example: "대부분의 임직원에게 부여되는 기본 출입 권한 등급"
        accessLevel:
          type: "integer"
          default: 1
          minimum: 1
          maximum: 255
        antipassbackLevel:
          type: "integer"
          default: 1
          minimum: 1
          maximum: 255
        armingLevel:
          type: "integer"
          default: 1
          minimum: 1
          maximum: 255
        isActive:
          type: "boolean"
          default: true

    SecurityThreshold:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        name:
          type: "string"
          example: "보안구역 레벨"
        description:
          type: "string"
          example: "출입 포인트에 설정할 최소 보안 요구사항"
        minAccessLevel:
          type: "integer"
          description: "최소 요구 출입 레벨 (1~255)"
          example: 10
        minAntipassbackLevel:
          type: "integer"
          default: 1
        minArmingLevel:
          type: "integer"
          default: 1
        isActive:
          type: "boolean"

    SecurityThresholdRequest:
      type: "object"
      required: ["name"]
      properties:
        name:
          type: "string"
          example: "보안구역 레벨"
        description:
          type: "string"
          example: "출입 포인트에 설정할 최소 보안 요구사항"
        minAccessLevel:
          type: "integer"
          default: 1
          minimum: 1
          maximum: 255
        minAntipassbackLevel:
          type: "integer"
          default: 1
          minimum: 1
          maximum: 255
        minArmingLevel:
          type: "integer"
          default: 1
          minimum: 1
          maximum: 255
        isActive:
          type: "boolean"
          default: true

    # ----------------------------------------------------
    # 3. Access Point Management
    # ----------------------------------------------------
    AccessPointType:
      type: "object"
      properties:
        code:
          type: "string"
          description: "출입 포인트 타입 코드 (DB 저장 값)"
          example: "DOOR"
        label:
          type: "string"
          description: "화면 표시용 라벨"
          example: "일반 출입문"

    AccessPoint:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        siteId:
          type: "string"
          format: "uuid"
          description: "소속 사이트 ID"
        facilityId:
          type: "string"
          format: "uuid"
          description: "소속 시설물 ID"
        sectorId:
          type: "string"
          format: "uuid"
          description: "소속 구획 ID"
        areaId:
          type: "string"
          format: "uuid"
          description: "소속 구역 ID"
        siteName:
          type: "string"
          description: "[Read-Only] 소속 사이트명"
          example: "본사 캠퍼스"
          readOnly: true
        facilityName:
          type: "string"
          description: "[Read-Only] 소속 시설물명"
          example: "본관 빌딩"
          readOnly: true
        sectorName:
          type: "string"
          description: "[Read-Only] 소속 구획명"
          example: "3층"
          readOnly: true
        areaName:
          type: "string"
          description: "[Read-Only] 소속 구역명"
          example: "보안구역 A"
          readOnly: true
        name:
          type: "string"
          example: "본관 1층 정문"
        description:
          type: "string"
          example: "본관 빌딩 1층에 위치한 주요 출입문"
        code:
          type: "string"
          example: "AP-ENT-001"
        type:
          type: "string"
          enum: ["DOOR", "GATE_DOOR", "TURNSTILE", "ELEVATOR", "SPEED_GATE", "BARRIER", "SLIDING", "SHUTTER", "BOLLARD"]
        fromAreaId:
          type: "string"
          format: "uuid"
          description: "진입 전 구역 ID (안티패스백용)"
        toAreaId:
          type: "string"
          format: "uuid"
          description: "진입 후 구역 ID (안티패스백용)"
        config:
          type: "object"
          description: "하드웨어 제어 관련 설정 (개방 시간, 릴레이 등)"
        securityConfig:
          $ref: "#/components/schemas/AccessPointConfig"
          description: "적용된 보안 정책 정보 (등급, 인증 규칙 등)"
        devices:
          type: "array"
          items:
            $ref: "#/components/schemas/AccessPointDevice"
          description: "연결된 물리적 장비 목록"
        isActive:
          type: "boolean"
        createdAt:
          type: "string"
          format: "date-time"
        updatedAt:
          type: "string"
          format: "date-time"

    AccessPointDeviceRequest:
      type: "object"
      required: ["deviceId", "deviceRole"]
      properties:
        deviceId:
          type: "string"
          format: "uuid"
          description: "연결할 장비 ID"
        deviceRole:
          type: "string"
          enum: ["ENTRY", "EXIT", "CONTROLLER", "SENSOR"]
          description: "장비의 역할 (입실 리더기, 퇴실 리더기, 컨트롤러 등)"
        portIndex:
          type: "integer"
          description: "컨트롤러 연결 포트 번호 (선택 사항)"
        authenticationModes:
          type: "array"
          items:
            type: "string"
            enum: ["CARD", "PIN", "BIOMETRIC", "MOBILE"]
          description: "인증 타입 (리더기인 경우, 선택 사항)"

    AccessPointDevice:
      type: "object"
      description: "출입 지점에 연결된 장비 상세 정보"
      properties:
        deviceId:
          type: "string"
          format: "uuid"
        deviceName:
          type: "string"
          description: "장비명"
          example: "정문 입실 리더기"
        deviceCode:
          type: "string"
          description: "장비 코드"
          example: "DEV-READER-001"
        deviceType:
          type: "string"
          enum: ["ACU", "READER", "CONTROLLER", "CAMERA", "SENSOR"]
          description: "장비 타입 (ACU, READER, CONTROLLER, CAMERA, SENSOR)"
        deviceRole:
          type: "string"
          enum: ["ENTRY", "EXIT", "CONTROLLER", "SENSOR"]
          description: "이 출입 지점에서의 역할"
        portIndex:
          type: "integer"
          description: "연결 포트 번호" 
        authenticationModes:
          type: "array"
          items:
            type: "string"
            enum: ["CARD", "PIN", "BIOMETRIC", "MOBILE"]
          description: "인증 타입 (리더기인 경우)"

    AccessPointRequest:
      type: "object"
      required: ["name", "type", "securityConfig"]
      description: |
        출입 지점 생성/수정 요청 객체.<br>
        `siteId`, `facilityId`, `sectorId`, `areaId` 중 하나를 선택하여 공간을 지정합니다.<br>
        **보안 설정(Security Config):** <br>
        - **보안 임계값(Threshold):** ID 참조와 직접 값 입력을 모두 지원하는 하이브리드 방식입니다. ID가 입력되면 ID의 정책을 따르고, ID가 없으면 직접 입력된 값(Level)을 사용합니다.<br>
        - **인증 규칙(Authentication):** 오직 ID 참조만 가능합니다. (직접 입력 불가)
      properties:
        siteId:
          type: "string"
          format: "uuid"
          nullable: true
          description: "소속 사이트 ID (선택)"
        facilityId:
          type: "string"
          format: "uuid"
          nullable: true
          description: "소속 시설물 ID (선택)"
        sectorId:
          type: "string"
          format: "uuid"
          nullable: true
          description: "소속 층/구획 ID (선택)"
        areaId:
          type: "string"
          format: "uuid"
          nullable: true
          description: "소속 구역 ID (선택)"
        name:
          type: "string"
        description:
          type: "string"
        code:
          type: "string"
        type:
          type: "string"
          enum: ["DOOR", "GATE_DOOR", "TURNSTILE", "ELEVATOR", "SPEED_GATE", "BARRIER", "SLIDING", "SHUTTER", "BOLLARD"]
          default: "DOOR"
        fromAreaId:
          type: "string"
          format: "uuid"
          nullable: true
        toAreaId:
          type: "string"
          format: "uuid"
          nullable: true
        config:
          type: "object"
          nullable: true
          description: "하드웨어 제어 설정 (개방 시간 등)"
        securityConfig:
          type: "object"
          required: ["entryAuthenticationRuleId", "exitAuthenticationRuleId"]
          properties:
            # --- [보안 설정 - 입실 (Entry)] ---
            entrySecurityThresholdId:
              type: "string"
              format: "uuid"
              nullable: true
              description: "[하이브리드] 입실 보안 임계값 ID (우선 적용)"
            entryAccessLevel:
              type: "integer"
              nullable: true
              default: 0
              minimum: 0
              description: "[하이브리드] 입실 출입 레벨 직접 지정 (ID 미지정 시 적용, 미입력 시 0)"
            entryAntipassbackLevel:
              type: "integer"
              nullable: true
              default: 0
              minimum: 0
              description: "[하이브리드] 입실 안티패스백 레벨 직접 지정 (ID 미지정 시 적용, 미입력 시 0)"
            entryArmingLevel:
              type: "integer"
              nullable: true
              default: 0
              minimum: 0
              description: "[하이브리드] 입실 경비(Arming) 레벨 직접 지정 (ID 미지정 시 적용, 미입력 시 0)"

            # --- [보안 설정 - 퇴실 (Exit)] ---
            exitSecurityThresholdId:
              type: "string"
              format: "uuid"
              nullable: true
              description: "[하이브리드] 퇴실 보안 임계값 ID (우선 적용)"
            exitAccessLevel:
              type: "integer"
              nullable: true
              default: 0
              minimum: 0
              description: "[하이브리드] 퇴실 출입 레벨 직접 지정 (ID 미지정 시 적용, 미입력 시 0)"
            exitAntipassbackLevel:
              type: "integer"
              nullable: true
              default: 0
              minimum: 0
              description: "[하이브리드] 퇴실 안티패스백 레벨 직접 지정 (ID 미지정 시 적용, 미입력 시 0)"
            exitArmingLevel:
              type: "integer"
              nullable: true
              default: 0
              minimum: 0
              description: "[하이브리드] 퇴실 경비(Arming) 레벨 직접 지정 (ID 미지정 시 적용, 미입력 시 0)"
        devices:
          type: "array"
          description: "출입 포인트 생성 시 연결할 장비 목록"
          items:
            $ref: "#/components/schemas/AccessPointDeviceRequest"

    AccessPointConfig:
      type: "object"
      description: "출입 지점의 보안 정책 설정 정보 (하이브리드 지원)"
      properties:
        
        # --- [입실] ---
        entrySecurityThresholdId:
          type: "string"
          format: "uuid"
          description: "입실 보안 임계값 ID"
          nullable: true
        entryAccessLevel:
          type: "integer"
          description: "입실 출입 레벨"
          nullable: true
        entryAntipassbackLevel:
          type: "integer"
          description: "입실 안티패스백 레벨"
          nullable: true
        entryArmingLevel:
          type: "integer"
          description: "입실 경비 레벨"
          nullable: true
        
        # --- [퇴실] ---
        exitSecurityThresholdId:
          type: "string"
          format: "uuid"
          description: "퇴실 보안 임계값 ID"
          nullable: true
        exitAccessLevel:
          type: "integer"
          description: "퇴실 출입 레벨"
          nullable: true
        exitAntipassbackLevel:
          type: "integer"
          description: "퇴실 안티패스백 레벨"
          nullable: true
        exitArmingLevel:
          type: "integer"
          description: "퇴실 경비 레벨"
          nullable: true

    AccessPointSummary:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        name:
          type: "string"
          example: "본관 1층 정문"

    AccessPointGroup:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        name:
          type: "string"
          example: "1층 전체 출입문"
        description:
          type: "string"
        accessPoints:
          type: "array"
          description: "그룹에 포함된 출입 포인트 목록 (ID + 이름)"
          items:
            $ref: "#/components/schemas/AccessPointSummary"
        isActive:
          type: "boolean"
        createdAt:
          type: "string"
          format: "date-time"
        updatedAt:
          type: "string"
          format: "date-time"

    AccessPointGroupRequest:
      type: "object"
      required: ["name"]
      properties:
        name:
          type: "string"
        description:
          type: "string"
        accessPointIds:
          type: "array"
          description: "그룹에 포함시킬 출입 포인트 ID 목록"
          items:
            type: "string"
            format: "uuid"

    # ----------------------------------------------------
    # 4. Access Rules (Priority-Based)
    # ----------------------------------------------------
    AccessRule:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        organizationId:
          type: "string"
          format: "uuid"
        name:
          type: "string"
          example: "정규직 평일 출입"
        description:
          type: "string"
        priority:
          type: "integer"
          description: "우선순위 (0~255). 높은 값이 낮은 값을 이깁니다. (Override)"
          example: 10
        items:
          type: "array"
          items:
            $ref: "#/components/schemas/AccessRuleItem"
        isActive:
          type: "boolean"
        createdAt:
          type: "string"
          format: "date-time"
        updatedAt:
          type: "string"
          format: "date-time"

    AccessRuleItem:
      type: "object"
      properties:
        id:
          type: "string"
          format: "uuid"
        accessRuleId:
          type: "string"
          format: "uuid"
        accessPointId:
          type: "string"
          format: "uuid"
          description: "개별 출입문 ID (그룹과 둘 중 하나만 존재)"
          nullable: true
        accessPointGroupId:
          type: "string"
          format: "uuid"
          description: "출입문 그룹 ID (개별 문과 둘 중 하나만 존재)"
          nullable: true
        targetName:
          type: "string"
          description: "[Read-Only] 대상 이름 (출입문명 또는 그룹명)"
          readOnly: true
        timeScheduleId:
          type: "string"
          format: "uuid"
          description: "적용할 시간 스케줄 ID"
        timeScheduleName:
          type: "string"
          description: "[Read-Only] 시간 스케줄 이름"
          readOnly: true

    AccessRuleItemRequest:
      type: "object"
      required: ["timeScheduleId"]
      properties:
        accessPointId:
          type: "string"
          format: "uuid"
          description: "개별 출입문 ID (그룹 ID가 없으면 필수)"
          nullable: true
        accessPointGroupId:
          type: "string"
          format: "uuid"
          description: "출입문 그룹 ID (개별 문 ID가 없으면 필수)"
          nullable: true
        timeScheduleId:
          type: "string"
          format: "uuid"

    AccessRuleRequest:
      type: "object"
      required: ["name", "priority", "items"]
      properties:
        name:
          type: "string"
        description:
          type: "string"
        priority:
          type: "integer"
          minimum: 0
          maximum: 255
          default: 0
          description: "우선순위 (0~255). 높은 값이 승리."
        items:
          type: "array"
          minItems: 1
          items:
            $ref: "#/components/schemas/AccessRuleItemRequest"
        isActive:
          type: "boolean"
          default: true